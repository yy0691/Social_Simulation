<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¤¾ç¾¤æ•°æ®æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .data-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .stat-card {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #00d4ff;
        }
        .stat-label {
            font-size: 12px;
            color: #ccc;
            margin-top: 5px;
        }
        .agent-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        .agent-card {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 8px;
            padding: 10px;
        }
        .error {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 8px;
            padding: 15px;
        }
        button {
            background: linear-gradient(135deg, #00d4ff, #8b5cf6);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® AIç¤¾ç¾¤æ¨¡æ‹Ÿå°æ¸¸æˆ - æ•°æ®æµ‹è¯•</h1>
        
        <div>
            <button onclick="loadCommunityStats()">åŠ è½½ç¤¾ç¾¤ç»Ÿè®¡</button>
            <button onclick="loadAgents()">åŠ è½½AIå±…æ°‘</button>
            <button onclick="loadEvents()">åŠ è½½äº‹ä»¶å†å²</button>
            <button onclick="loadAll()">åŠ è½½æ‰€æœ‰æ•°æ®</button>
        </div>

        <div id="community-stats" class="data-section" style="display: none;">
            <h2>ğŸ“Š ç¤¾ç¾¤ç»Ÿè®¡</h2>
            <div id="stats-content"></div>
        </div>

        <div id="agents-data" class="data-section" style="display: none;">
            <h2>ğŸ‘¥ AIå±…æ°‘ (<span id="agent-count">0</span>)</h2>
            <div id="agents-content"></div>
        </div>

        <div id="events-data" class="data-section" style="display: none;">
            <h2>ğŸ“ æœ€è¿‘äº‹ä»¶</h2>
            <div id="events-content"></div>
        </div>

        <div id="error-display" class="error" style="display: none;"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';

        async function apiCall(endpoint) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                return await response.json();
            } catch (error) {
                showError(`APIè°ƒç”¨å¤±è´¥: ${error.message}`);
                throw error;
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('error-display');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        async function loadCommunityStats() {
            try {
                const result = await apiCall('/api/v1/community/status');
                const stats = result.data;
                
                const statsHtml = `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value">${stats.population}</div>
                            <div class="stat-label">ç¤¾ç¾¤äººå£</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${Math.round(stats.happiness)}%</div>
                            <div class="stat-label">å¹¸ç¦æŒ‡æ•°</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${Math.round(stats.health)}%</div>
                            <div class="stat-label">å¥åº·åº¦</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${Math.round(stats.education)}%</div>
                            <div class="stat-label">æ•™è‚²æ°´å¹³</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${Math.round(stats.economy)}%</div>
                            <div class="stat-label">ç»æµçŠ¶å†µ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${Math.round(calculateActivity(stats))}%</div>
                            <div class="stat-label">æ´»è·ƒåº¦</div>
                        </div>
                    </div>
                    <p><strong>æ¨¡æ‹ŸçŠ¶æ€:</strong> ${stats.simulation?.is_running ? 'è¿è¡Œä¸­' : 'å·²åœæ­¢'}</p>
                    <p><strong>æœ€åæ›´æ–°:</strong> ${new Date(stats.last_updated).toLocaleString('zh-CN')}</p>
                `;
                
                document.getElementById('stats-content').innerHTML = statsHtml;
                document.getElementById('community-stats').style.display = 'block';
            } catch (error) {
                console.error('åŠ è½½ç¤¾ç¾¤ç»Ÿè®¡å¤±è´¥:', error);
            }
        }

        async function loadAgents() {
            try {
                const result = await apiCall('/api/v1/community/agents');
                const agents = result.data.agents;
                
                document.getElementById('agent-count').textContent = agents.length;
                
                const agentsHtml = agents.map(agent => `
                    <div class="agent-card">
                        <h4>${agent.name}</h4>
                        <p><strong>èŒä¸š:</strong> ${agent.occupation}</p>
                        <p><strong>æ€§æ ¼:</strong> ${agent.personality}</p>
                        <p><strong>å¹´é¾„:</strong> ${agent.age}</p>
                        <p><strong>å¹¸ç¦åº¦:</strong> ${Math.round(agent.happiness)}%</p>
                        <p><strong>å¥åº·åº¦:</strong> ${Math.round(agent.health)}%</p>
                        <p><strong>æ•™è‚²:</strong> ${Math.round(agent.education)}%</p>
                        <p><strong>è´¢å¯Œ:</strong> ${Math.round(agent.wealth)}%</p>
                    </div>
                `).join('');
                
                document.getElementById('agents-content').innerHTML = `<div class="agent-list">${agentsHtml}</div>`;
                document.getElementById('agents-data').style.display = 'block';
            } catch (error) {
                console.error('åŠ è½½AIå±…æ°‘å¤±è´¥:', error);
            }
        }

        async function loadEvents() {
            try {
                const result = await apiCall('/api/v1/community/events');
                const events = result.data.events;
                
                const eventsHtml = events.length > 0 ? 
                    events.map(event => `
                        <div class="agent-card">
                            <h4>${event.title || 'æœªçŸ¥äº‹ä»¶'}</h4>
                            <p>${event.description}</p>
                            <p><strong>ç±»å‹:</strong> ${event.event_type || event.type}</p>
                            <p><strong>æ—¶é—´:</strong> ${new Date(event.timestamp).toLocaleString('zh-CN')}</p>
                        </div>
                    `).join('') : '<p>æš‚æ— äº‹ä»¶è®°å½•</p>';
                
                document.getElementById('events-content').innerHTML = `<div class="agent-list">${eventsHtml}</div>`;
                document.getElementById('events-data').style.display = 'block';
            } catch (error) {
                console.error('åŠ è½½äº‹ä»¶å†å²å¤±è´¥:', error);
            }
        }

        function calculateActivity(stats) {
            const happiness = stats.happiness || 0;
            const health = stats.health || 0;
            const economy = stats.economy || 0;
            return Math.max(0, Math.min(100, happiness * 0.4 + health * 0.3 + economy * 0.3));
        }

        async function loadAll() {
            await Promise.all([
                loadCommunityStats(),
                loadAgents(),
                loadEvents()
            ]);
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½æ‰€æœ‰æ•°æ®
        window.addEventListener('load', loadAll);
    </script>
</body>
</html> 